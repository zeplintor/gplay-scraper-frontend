 <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayStore Analytics Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        input, textarea {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 15px;
            font-family: inherit;
        }

        textarea { min-height: 150px; font-family: monospace; }

        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        button:hover { transform: translateY(-2px); }
        button:disabled { background: #ccc; }

        .btn-success { background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); }
        .btn-danger { background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); }
        .btn-warning { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); }

        .result {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .app-header {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .app-icon {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #4caf50);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .bulk-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 10000;
        }

        .toast.success { background: #4caf50; }
        .toast.error { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç PlayStore Analytics Pro</h1>
            <p>Analyse compl√®te d'applications Android</p>
            <div id="licenseStatus"></div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" id="tab1">üîç Simple</button>
            <button class="tab-btn" id="tab2">üìä Bulk</button>
            <button class="tab-btn" id="tab3">‚öñÔ∏è Comparer</button>
            <button class="tab-btn" id="tab4">‚öôÔ∏è Licence</button>
        </div>

        <!-- TAB 1: SIMPLE -->
        <div id="content1" class="tab-content active">
            <div class="box">
                <input type="text" id="appId" placeholder="ID app (ex: com.roblox.client)" value="com.roblox.client">
                <button id="searchBtn">üîç Analyser</button>
            </div>
            <div id="loading1" class="loading" style="display:none;">
                <div class="spinner"></div>
                <p>Chargement...</p>
            </div>
            <div id="result1"></div>
        </div>

        <!-- TAB 2: BULK -->
        <div id="content2" class="tab-content">
            <div class="box">
                <h3>üìä Analyse Group√©e</h3>
                <textarea id="bulkInput" placeholder="com.roblox.client&#10;com.whatsapp&#10;com.instagram.android"></textarea>
                <button id="bulkBtn">üöÄ Analyser</button>
                <button id="pauseBtn" class="btn-warning" style="display:none;">‚è∏Ô∏è Pause</button>
                <button id="resumeBtn" class="btn-success" style="display:none;">‚ñ∂Ô∏è Reprendre</button>
                <button id="exportBtn" class="btn-success" disabled>üì• CSV</button>
                <button id="clearBtn" class="btn-danger">üóëÔ∏è Effacer</button>
                <div id="progress" style="display:none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar">0%</div>
                    </div>
                </div>
            </div>
            <div id="bulkResults"></div>
            <div id="chartBox" class="box" style="display:none;">
                <h3>üìä Graphique</h3>
                <canvas id="chart"></canvas>
            </div>
        </div>

        <!-- TAB 3: COMPARE -->
        <div id="content3" class="tab-content">
            <div class="box">
                <h3>‚öñÔ∏è Comparer 2 Apps</h3>
                <input id="app1" placeholder="App 1 (ex: com.whatsapp)">
                <input id="app2" placeholder="App 2 (ex: org.telegram.messenger)">
                <button id="compareBtn">‚öñÔ∏è Comparer</button>
            </div>
            <div id="compareResult"></div>
        </div>

        <!-- TAB 4: LICENSE -->
        <div id="content4" class="tab-content">
            <div class="box">
                <h3>üîë Activer Licence</h3>
                <p>Entrez votre cl√© Gumroad :</p>
                <input id="licenseKey" placeholder="PREMIUM-2025">
                <button id="activateBtn">‚úì Activer</button>
                <br><br>
                <p><strong>Cl√©s de test :</strong> PREMIUM-2025, TEST-LICENSE</p>
                <br>
                <a href="https://votresite.gumroad.com/l/playstore-pro" target="_blank">
                    <button class="btn-success">üí≥ Acheter Licence - 9.99‚Ç¨</button>
                </a>
                <hr style="margin:30px 0">
                <h3>üíæ Cache</h3>
                <p id="cacheInfo">Cache vide</p>
                <button id="clearCacheBtn" class="btn-danger">üóëÔ∏è Vider Cache</button>
            </div>
        </div>
    </div>

    <script>
        const API = 'https://gplay-scraper-backend.onrender.com';
        let bulkData = [];
        let bulkPaused = false;
        let bulkIndex = 0;
        let chart = null;

        // TABS
        document.getElementById('tab1').onclick = () => showTab(1);
        document.getElementById('tab2').onclick = () => showTab(2);
        document.getElementById('tab3').onclick = () => showTab(3);
        document.getElementById('tab4').onclick = () => showTab(4);

        function showTab(n) {
            for(let i=1; i<=4; i++) {
                document.getElementById('content'+i).classList.remove('active');
                document.getElementById('tab'+i).classList.remove('active');
            }
            document.getElementById('content'+n).classList.add('active');
            document.getElementById('tab'+n).classList.add('active');
        }

        // UTILS
        function fmt(n) {
            if(!n) return '0';
            if(n >= 1e9) return (n/1e9).toFixed(1)+'B';
            if(n >= 1e6) return (n/1e6).toFixed(1)+'M';
            if(n >= 1e3) return (n/1e3).toFixed(1)+'K';
            return n.toString();
        }

        function toast(msg, type) {
            const t = document.createElement('div');
            t.className = 'toast ' + type;
            t.textContent = msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        function cache(key, val) {
            if(val) {
                const c = JSON.parse(localStorage.getItem('cache') || '{}');
                c[key] = {data: val, time: Date.now()};
                localStorage.setItem('cache', JSON.stringify(c));
                updateCache();
            } else {
                const c = JSON.parse(localStorage.getItem('cache') || '{}');
                if(c[key] && (Date.now() - c[key].time) < 86400000) return c[key].data;
                return null;
            }
        }

        function updateCache() {
            const c = JSON.parse(localStorage.getItem('cache') || '{}');
            document.getElementById('cacheInfo').textContent = Object.keys(c).length + ' apps en cache';
        }

        // LICENSE
        function checkLicense() {
            const key = localStorage.getItem('license');
            if(key && (key === 'PREMIUM-2025' || key === 'TEST-LICENSE' || key.startsWith('GR-'))) {
                document.getElementById('licenseStatus').innerHTML = 
                    '<span style="background:#4caf50;color:white;padding:8px 20px;border-radius:20px;display:inline-block;margin-top:15px;">‚úì Premium</span>';
            }
        }

        document.getElementById('activateBtn').onclick = function() {
            const key = document.getElementById('licenseKey').value.trim();
            if(!key) return toast('Entrez une cl√©', 'error');
            if(key === 'PREMIUM-2025' || key === 'TEST-LICENSE' || key.startsWith('GR-')) {
                localStorage.setItem('license', key);
                toast('Licence activ√©e !', 'success');
                checkLicense();
            } else {
                toast('Cl√© invalide', 'error');
            }
        };

        document.getElementById('clearCacheBtn').onclick = function() {
            localStorage.removeItem('cache');
            updateCache();
            toast('Cache vid√©', 'success');
        };

        // SIMPLE SEARCH
        document.getElementById('searchBtn').onclick = async function() {
            const id = document.getElementById('appId').value.trim();
            if(!id) return toast('Entrez un ID', 'error');

            const cached = cache(id);
            if(cached) {
                displayResult(cached);
                return toast('Charg√© du cache', 'success');
            }

            document.getElementById('loading1').style.display = 'block';
            document.getElementById('result1').innerHTML = '';

            try {
                const res = await fetch(API + '/api/search/' + id);
                const data = await res.json();
                if(data.success) {
                    cache(id, data.data);
                    displayResult(data.data);
                } else {
                    toast('App non trouv√©e', 'error');
                }
            } catch(e) {
                toast('Erreur: ' + e.message, 'error');
            }
            document.getElementById('loading1').style.display = 'none';
        };

        function displayResult(d) {
            document.getElementById('result1').innerHTML = 
                '<div class="result">' +
                '<div class="app-header">' +
                '<img class="app-icon" src="'+d.icon+'">' +
                '<div><h2>'+d.title+'</h2><p>'+d.developer+'</p><span style="background:#667eea;color:white;padding:5px 15px;border-radius:20px;">'+d.genre+'</span></div>' +
                '</div>' +
                '<div class="stats-grid">' +
                '<div class="stat-card"><div class="stat-label">Note</div><div class="stat-value">'+(d.score?d.score.toFixed(1):'N/A')+' ‚≠ê</div></div>' +
                '<div class="stat-card"><div class="stat-label">Avis</div><div class="stat-value">'+fmt(d.ratings)+'</div></div>' +
                '<div class="stat-card"><div class="stat-label">Installs</div><div class="stat-value">'+d.installs+'</div></div>' +
                '<div class="stat-card"><div class="stat-label">Prix</div><div class="stat-value">'+(d.free?'Gratuit':'$'+d.price)+'</div></div>' +
                '</div>' +
                '<p style="background:#f8f9fa;padding:20px;border-radius:10px;"><strong>Description:</strong><br>'+d.summary+'</p>' +
                '</div>';
        }

        // BULK
        document.getElementById('bulkBtn').onclick = async function() {
            const ids = document.getElementById('bulkInput').value.split('\n').map(x=>x.trim()).filter(x=>x);
            if(ids.length === 0) return toast('Entrez des IDs', 'error');

            bulkData = [];
            bulkPaused = false;
            bulkIndex = 0;
            document.getElementById('bulkResults').innerHTML = '';
            document.getElementById('chartBox').style.display = 'none';
            document.getElementById('progress').style.display = 'block';
            document.getElementById('bulkBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            document.getElementById('exportBtn').disabled = true;

            await processBulk(ids);
        };

        async function processBulk(ids) {
            for(; bulkIndex < ids.length; bulkIndex++) {
                if(bulkPaused) return;

                const id = ids[bulkIndex];
                const pct = Math.round(((bulkIndex+1)/ids.length)*100);
                document.getElementById('progressBar').style.width = pct+'%';
                document.getElementById('progressBar').textContent = pct+'%';

                const cached = cache(id);
                if(cached) {
                    bulkData.push(cached);
                    showBulkItem(cached);
                    continue;
                }

                try {
                    const res = await fetch(API + '/api/search/' + id);
                    const data = await res.json();
                    if(data.success) {
                        cache(id, data.data);
                        bulkData.push(data.data);
                        showBulkItem(data.data);
                    }
                } catch(e) {}

                await new Promise(r => setTimeout(r, 500));
            }

            document.getElementById('bulkBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('exportBtn').disabled = false;
            if(bulkData.length > 0) {
                showChart();
                toast('Termin√©: '+bulkData.length+' apps', 'success');
            }
        }

        document.getElementById('pauseBtn').onclick = function() {
            bulkPaused = true;
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('resumeBtn').style.display = 'inline-block';
            toast('Pause', 'success');
        };

        document.getElementById('resumeBtn').onclick = function() {
            bulkPaused = false;
            document.getElementById('resumeBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            const ids = document.getElementById('bulkInput').value.split('\n').map(x=>x.trim()).filter(x=>x);
            processBulk(ids);
        };

        document.getElementById('clearBtn').onclick = function() {
            document.getElementById('bulkInput').value = '';
            document.getElementById('bulkResults').innerHTML = '';
            document.getElementById('chartBox').style.display = 'none';
            bulkData = [];
            toast('Effac√©', 'success');
        };

        function showBulkItem(d) {
            const div = document.createElement('div');
            div.className = 'bulk-item';
            div.innerHTML = '<h4>‚úÖ '+d.title+'</h4><p>Note: '+(d.score?d.score.toFixed(1):'N/A')+' ‚≠ê | Avis: '+fmt(d.ratings)+' | Dev: '+d.developer+'</p>';
            document.getElementById('bulkResults').appendChild(div);
        }

        function showChart() {
            document.getElementById('chartBox').style.display = 'block';
            const ctx = document.getElementById('chart');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bulkData.map(d => d.title.substring(0,15)),
                    datasets: [{
                        label: 'Note',
                        data: bulkData.map(d => d.score || 0),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    scales: { y: { max: 5 } }
                }
            });
        }

        document.getElementById('exportBtn').onclick = function() {
            let csv = 'Titre,Note,Avis,Installs,Dev\n';
            bulkData.forEach(d => {
                csv += '"'+d.title+'",'+d.score+','+d.ratings+',"'+d.installs+'","'+d.developer+'"\n';
            });
            const blob = new Blob([csv], {type:'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'export-'+Date.now()+'.csv';
            a.click();
            toast('CSV export√©', 'success');
        };

        // COMPARE
        document.getElementById('compareBtn').onclick = async function() {
            const id1 = document.getElementById('app1').value.trim();
            const id2 = document.getElementById('app2').value.trim();
            if(!id1 || !id2) return toast('Entrez 2 IDs', 'error');

            try {
                const [r1, r2] = await Promise.all([
                    fetch(API+'/api/search/'+id1),
                    fetch(API+'/api/search/'+id2)
                ]);
                const [d1, d2] = await Promise.all([r1.json(), r2.json()]);
                if(d1.success && d2.success) {
                    document.getElementById('compareResult').innerHTML = 
                        '<div class="result">' +
                        '<h3 style="text-align:center;margin-bottom:20px;">‚öñÔ∏è Comparaison</h3>' +
                        '<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">' +
                        '<div style="text-align:center;"><img src="'+d1.data.icon+'" style="width:80px;height:80px;border-radius:20px;"><h4>'+d1.data.title+'</h4><p>Note: '+d1.data.score.toFixed(1)+'‚≠ê</p><p>Avis: '+fmt(d1.data.ratings)+'</p></div>' +
                        '<div style="text-align:center;"><img src="'+d2.data.icon+'" style="width:80px;height:80px;border-radius:20px;"><h4>'+d2.data.title+'</h4><p>Note: '+d2.data.score.toFixed(1)+'‚≠ê</p><p>Avis: '+fmt(d2.data.ratings)+'</p></div>' +
                        '</div>' +
                        '<div style="margin-top:20px;padding:20px;background:#f8f9fa;border-radius:10px;">' +
                        '<p><strong>Meilleure note:</strong> '+(d1.data.score>d2.data.score?d1.data.title:d2.data.title)+'</p>' +
                        '<p><strong>Plus d\'avis:</strong> '+(d1.data.ratings>d2.data.ratings?d1.data.title:d2.data.title)+'</p>' +
                        '</div></div>';
                }
            } catch(e) {
                toast('Erreur: '+e.message, 'error');
            }
        };

        // INIT
        checkLicense();
        updateCache();
    </script>
</body>
</html>
